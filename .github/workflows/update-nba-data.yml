name: Update NBA On/Off Data

on:
  schedule:
    - cron: '0 8 * * *'
  workflow_dispatch:

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests pandas nba_api
      
      - name: Update all teams
        run: |
          cd python
          
          teams=(
            "Atlanta Hawks"
            "Boston Celtics"
            "Brooklyn Nets"
            "Charlotte Hornets"
            "Chicago Bulls"
            "Cleveland Cavaliers"
            "Dallas Mavericks"
            "Denver Nuggets"
            "Detroit Pistons"
            "Golden State Warriors"
            "Houston Rockets"
            "Indiana Pacers"
            "Los Angeles Clippers"
            "Los Angeles Lakers"
            "Memphis Grizzlies"
            "Miami Heat"
            "Milwaukee Bucks"
            "Minnesota Timberwolves"
            "New Orleans Pelicans"
            "New York Knicks"
            "Oklahoma City Thunder"
            "Orlando Magic"
            "Philadelphia 76ers"
            "Phoenix Suns"
            "Portland Trail Blazers"
            "Sacramento Kings"
            "San Antonio Spurs"
            "Toronto Raptors"
            "Utah Jazz"
            "Washington Wizards"
          )
          
          for team in "${teams[@]}"; do
            echo "üìä Updating $team..."
            python3 "${team} 2025-2026.py" --update || echo "‚ö†Ô∏è Failed: $team"
            sleep 2
          done
      
      - name: Copy updated files to onoff_cache
        run: |
          cp python/*_combo.json onoff_cache/
      
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git diff --staged --quiet || git commit -m "üèÄ Auto-update NBA on/off data $(date +'%Y-%m-%d')"
          git push
